!function(r){"use strict";var b,f,m,s,c,h,o,u,p,_,e,t,n,a,i,l;r.wbui||0||(b=document,f="getElementsByClassName",m=function(t){return b.querySelectorAll(t)},s="OK",c="Cancel",h=["dialog","toast","loading","iframe"],o={type:0,mask:!0,maskClose:!0,closebtn:!0,whenBtnClickClose:!0,fixed:!0,anim:"def"},u={extend:function(t,e){var n="object"==typeof e?JSON.parse(JSON.stringify(e)):JSON.parse(JSON.stringify(o));for(var a in t)n[a]=t[a];return n},timer:{},end:{},touch:function(t,e){t.addEventListener("click",function(t){e.call(this,t)},!1)}},p=0,_=["wbui"],(e=function(t){this.config=u.extend(t),this.view()}).prototype.view=function(){var t=this,n=t.config,e=b.createElement("div"),a="object"==typeof n.content,o="string"==typeof n.type?n.type:_[0]+"-"+h[n.type||0];t.id=e.id=_[0]+p,e.setAttribute("class",_[0]+" "+o),e.setAttribute("index",p);var i,r,s,c=(i="object"==typeof n.title,n.title?'<h3 class="wbui-title'+(i?" "+n.title[1]:"")+'">'+(i?n.title[0]:n.title)+"</h3>":""),u=(r="object"==typeof n.closebtn,n.closebtn?'<a class="wbui-close'+(r?" "+n.closetype[1]:"")+'"><i></i></a>':""),l=function(){"string"==typeof n.btn&&(n.btn=[n.btn]);var t,e=(n.btn||[]).length;return 0!==e&&n.btn?(t='<span yes type="1">'+n.btn[0]+"</span>",2===e&&(t='<span no type="0">'+n.btn[1]+"</span>"+t),'<div class="wbui-btn">'+t+"</div>"):""}();n.fixed||(n.top=n.hasOwnProperty("top")?n.top:100,n.style=n.style||"",n.style+=" top:"+(b.body.scrollTop+n.top)+"px"),2===n.type&&(n.content='<i></i><i class="wbui-load"></i><i></i><p>'+(n.content||"")+"</p>"),3===n.type&&(n.content=a?n.content:[n.content||"","auto"],n.content='<iframe scrolling="'+(n.content[1]||"auto")+'" allowtransparency="true" id="'+h[3]+p+'" name="'+h[3]+p+'" onload="this.className=\'\';" class="wbui-load" frameborder="0" src="'+n.content[0]+'"></iframe>'),n.skin&&(n.anim="fade"),"msg"===n.skin&&(n.mask=n.closebtn=!1,n.time=2),e.innerHTML=(n.mask?"<div "+("string"==typeof n.mask?'style="'+n.mask+'"':"")+' class="wbui-mask"></div>':"")+'<div class="wbui-main" '+(n.fixed?"":'style="position:static;"')+'><div class="wbui-section"><div class="wbui-child '+(n.skin?"wbui-"+n.skin+" ":"")+(n.className?n.className:"")+" "+(n.anim?"wbui-anim-"+n.anim:"")+'" '+(n.style?'style="'+n.style+'"':"")+">"+c+'<div class="wbui-cont">'+n.content+"</div>"+l+(n.closebtn?u:"")+"</div></div></div>",n.type&&2!==n.type||1<=(s=b[f](_[0]+h[n.type])).length&&wbui.close(s[0].getAttribute("index")),document.body.appendChild(e);var d=t.elem=m("#"+t.id)[0];n.success&&n.success(d),t.index=p++,t.action(n,d)},e.prototype.action=function(t,e){var n=this;t.time&&(u.timer[n.index]=setTimeout(function(){wbui.close(n.index)},1e3*t.time));function a(){0==this.getAttribute("type")?(t.no&&t.no(),wbui.close(n.index)):(t.yes&&t.yes(n.index),t.whenBtnClickClose&&wbui.close(n.index))}var o,i;if(t.btn)for(var r=e[f]("wbui-btn")[0].children,s=r.length,c=0;c<s;c++)u.touch(r[c],a);t.mask&&t.maskClose&&(o=e[f]("wbui-mask")[0],u.touch(o,function(){wbui.close(n.index,t.end)})),t.closebtn&&(i=e[f]("wbui-close")[0],u.touch(i,function(){wbui.close(n.index,t.end)})),t.end&&(u.end[n.index]=t.end)},r.wbui={v:"1.0.5",index:p,open:function(t){return new e(t||{}).index},alert:function(t,e){var n="function"==typeof e,a=u.extend({content:t,btn:s}),a=n?u.extend({yes:e},a):u.extend(e,a);return r.wbui.open(a)},confirm:function(t,e,n,a){var o="function"==typeof e,i=u.extend({content:t,btn:[s,c]}),i=o?u.extend({yes:e,no:n},i):u.extend(e,i);return r.wbui.open(i)},toast:function(t,e){var n="function"==typeof e,a=u.extend({type:1,content:t,mask:0,closebtn:0,time:2}),a=n?u.extend({end:e},a):u.extend(e,a);return r.wbui.open(a)},loading:function(t){var e="function"==typeof t,n=u.extend({type:2,content:0,mask:0,maskClose:0,closebtn:0}),n=e?u.extend({end:t},n):u.extend(t,n);return r.wbui.open(n)},iframe:function(t,e,n,a){var o="function"==typeof e,i=u.extend({type:3,content:t,mask:0}),i=o?u.extend({yes:e,no:n},i):u.extend(e,i);return r.wbui.open(i)},close:function(t){var e=m("#"+_[0]+t)[0];e&&(e.innerHTML="",b.body.removeChild(e),clearTimeout(u.timer[t]),delete u.timer[t],"function"==typeof u.end[t]&&u.end[t](),delete u.end[t])},closeAll:function(){for(var t=b[f](_[0]),e=0,n=t.length;e<n;e++)wbui.close(0|t[0].getAttribute("index"))}},n=document.scripts,a=n[n.length-1],i=a.src,l=i.substring(0,i.lastIndexOf("/")+1),a.getAttribute("assets")&&document.head.appendChild(((t=b.createElement("link")).href=l+"assets/wbui.css",t.type="text/css",t.rel="styleSheet",t.id="wbui_css",t)))}(window);var WB=window.WB||{};WB.SSTSettings={init:function(e){var n=WB.SSTSettings;n.switchAction(e),n.seoItem(e),n.inputLivePreview(e),n.analytics(e),n.navTabs(e),n.range(e,e("#J_sitemapSEOSettingBox .wbs-input-range"),function(t){return 100*t+"%"}),n.tabs(e,e("#J_normalSettingTabs")),e("#J_copySubSML").on("click",function(){var t=e("#J_subSML");n.copy(t)}),e.post(ajaxurl,{action:"wb_smart_seo_tool",do:"chk_ver"},function(t){t&&(e("#new_ver .ver").html(t),e("#new_ver").show())}),0<e("#404_url_box").length&&(n.load_404(),e("#404_url_more").on("click",function(){n.load_404()})),0<e("#broken_url_box").length&&(n.load_broken(),e("#broken_url_more .more-btn").on("click",function(){n.load_broken()}),e("#broken_url_type a").on("click",function(){e("#broken_url_type a.current").removeClass("current"),e(this).addClass("current"),jQuery("#broken_url_box").html(""),jQuery("#broken_url_box").data("offset",0),n.load_broken()}),e("#clear_broken_url").on("click",function(){wbui.confirm("确认重新检测？",function(){jQuery.post(ajaxurl,{action:"wb_smart_seo_tool",do:"clear_broken_url"},function(t){wbui.toast("提交成功",function(){location.reload()})})})}),e("#broken_url_batch_submit").on("click",function(){var n,t=e("#broken_url_batch").val();t&&(n=[],e(".broken_url_chk:checked").each(function(t,e){n.push(e.value)}),n.length<1||jQuery.post(ajaxurl,{action:"wb_smart_seo_tool",do:"broken_url_batch",op:t,ids:n.join(",")},function(t){wbui.toast("提交成功",function(){location.reload()})}))}),e(".batch_broken_chk").on("click",function(){e(".broken_url_chk").prop("checked",this.checked)}))},mark_broken_url:function(e,t){return wbui.confirm("确认标记为未失效？",function(){jQuery.post(ajaxurl,{action:"wb_smart_seo_tool",do:"mark_broken_url",id:t},function(t){jQuery(e).parent().find("span").html("200"),jQuery(e).remove(),wbui.toast("标记成功")},"json")}),!1},remove_broken:function(e,t){return wbui.confirm("确认删除？",function(){jQuery.post(ajaxurl,{action:"wb_smart_seo_tool",do:"remove_broken",id:t},function(t){jQuery(e).parent().parent().remove(),wbui.toast("已移除")},"json")}),!1},check_broken:function(e,t){return jQuery.post(ajaxurl,{action:"wb_smart_seo_tool",do:"check_broken",id:t},function(t){jQuery(e).parent().parent().find(".code").html(t.data),wbui&&wbui.toast("检测结果为["+t.data+"]")},"json"),!1},load_broken:function(){var o=jQuery("#broken_url_box"),i=o.data("total"),r=o.data("offset")||0,t=jQuery("#broken_url_type a.current").data("type")||0,r=parseInt(r);if(jQuery("#broken_url_more").hide(),jQuery("#broken_url_empty").hide(),!(!i||i<1||i<r))return jQuery.get(ajaxurl,{action:"wb_smart_seo_tool",do:"broken_url",offset:r,type:t},function(t){var e="";if(t.success&&t.data){for(var n=0;n<t.data.length;n++){var a=t.data[n];e+="<tr>",e+='<td><input type="checkbox" class="broken_url_chk" value="'+a.id+'"></td>',e+='<td><div class="url"><a href="'+a.url+'" target="_blank">'+a.url+"</a></div>",e+='</td><td><span class="code">'+a.code+"</span> </td>",e+='<td><a href="'+a.post_url+'" target="_blank">'+a.post_title+"</a></td>",e+='<td><a href="#" onclick="return WB.SSTSettings.check_broken(this,'+a.id+')">重新检查</a> | <a href="'+a.edit_url+'" target="_blank">编辑文章</a> | <a href="#" onclick="return WB.SSTSettings.remove_broken(this,'+a.id+')" target="_blank">取消链接</a> ',/^(4|5|e)/.test(a.code)&&(e+='| <a href="#" title="标记为正常" onclick="return WB.SSTSettings.mark_broken_url(this,'+a.id+')">未失效</a>'),e+="</td></tr>"}o.append(e),o.data("offset",r+30),t.data.length<30?jQuery("#broken_url_more").hide():r+t.data.length<i&&jQuery("#broken_url_more").show(),jQuery("#broken_footer").show()}else jQuery("#broken_url_more").hide();o.find("tr").length<1&&(jQuery("#broken_url_empty").show(),jQuery("#broken_footer").hide())},"json"),!1},remove_404:function(e,t){return wbui.confirm("确认忽略？",function(){jQuery.post(ajaxurl,{action:"wb_smart_seo_tool",do:"remove_404",id:t},function(t){jQuery(e).parent().parent().remove(),wbui.toast("已忽略")},"json")}),!1},refresh_404:function(e,t){return jQuery.post(ajaxurl,{action:"wb_smart_seo_tool",do:"refresh_404",id:t},function(t){t.success?(jQuery(e).parent().parent().find(".code").html(t.data),wbui.toast("检测结果为["+t.data+"]")):wbui.toast("检测失败,["+t.data+"]")},"json"),!1},load_404:function(){var o=jQuery("#404_url_box"),i=o.data("total"),r=o.data("offset")||0,r=parseInt(r);if(jQuery("#404_url_more").hide(),!(!i||i<1||i<r))return jQuery.get(ajaxurl,{action:"wb_smart_seo_tool",do:"404_url",offset:r},function(t){var e="";if(t.success&&t.data){for(var n=0;n<t.data.length;n++){var a=t.data[n];e+="<tr>",e+='<td><div class="url"><a href="'+a.url+'" target="_blank">'+a.url+"</a></div></td>",e+='<td><span class="code">'+a.code+"</span></td>",e+="<td>"+a.spider+"</td>",e+='<td class="m-hide">'+a.visit_date+"</td>",e+='<td class="m-hide"> <a href="#" onclick="return WB.SSTSettings.refresh_404(this,'+a.id+')">刷新状态</a> <a href="#" onclick="return WB.SSTSettings.remove_404(this,'+a.id+')">忽略</a> </td>',e+="</tr>"}o.append(e),o.data("offset",r+30),r+t.data.length<i&&jQuery("#404_url_more").show()}},"json"),!1},switchAction:function(n,t){(t||n(".wb-switch[data-target]")).on("change",function(){var t=n(this),e=n(t.data("target"));t.prop("checked")?(t.attr("data-value","true"),e.addClass("active")):(t.attr("data-value","false"),e.removeClass("active"))})},seoItem:function(n){n(".input-with-count").each(function(){var t=n(this);WB.SSTSettings.getInputTextLength(n,t.find("[data-max]"),t.find(".count"))}),n(".settings-cate-dropdown").on("change",function(){var t=n(this).val();n(".settings-cate-dropdown").val("0"),n(this).val(t),"0"!=t?(n(".cate_seo .cate-item").removeClass("active"),n("#J_seo_"+t).addClass("active")):n(".cate_seo .cate-item").removeClass("active")}),n(".wb-tags-module").each(function(){WB.SSTSettings.tagsModule(n,n(this))}),n(".preview-desc").each(function(){var t=n(this),e=t.text();200<e.length&&(e=e.substring(0,200)+"..."),t.text(e)}),n(".preview-title").each(function(){var t=n(this),e=t.text();120<e.length&&(e=e.substring(0,120)+"..."),t.text(e)}),n("#J_switchDisplayMoreItems").on("click",function(){"0"==n(this).attr("data-active")?(n(this).text("[ - 收起 ]"),n(this).attr("data-active","1")):(n(this).text("[ + 展开 ]"),n(this).attr("data-active","0")),n("#J_moreSEOItems").toggleClass("active")})},tagsModule:function(i,t){var e=t||i(".wb-tags-module"),a=e.find("[data-tags-value]"),r=e.find(".wb-tag-input"),n=e.find(".tag-items"),o=e.find(".count"),s=a.val(),c=!1,u=0;function l(t){s=""!=s?s+","+t:t,a.val(s)}function d(t){var e='<div class="tag-item"><span>'+t+' </span><a class="del" data-del-val="'+t+'"></a></div>';n.append(e)}function b(t){var e=t||s.length,n=a.data("max")||100;o.html("已输入<b>"+e+"</b>"),o[n<e?"addClass":"removeClass"]("hl")}b(),r.on("keydown blur paste",function(t){var e=t.keyCode||t.which||0,n=i(this);if(32===e?u++:u=0,"paste"!=t.type||c||(c=!0),"blur"===t.type||13===e||188===e||1<u){var a,o=i.trim(r.val());return""==o?!1:(c?(a=o.split(","),console.log(a),0<a.length&&a.forEach(function(t){var e=i.trim(t);if(""==e)return!1;d(e),l(e)}),c=!1):(d(o),l(o)),n.val(""),b(),!1)}if(8===e&&0===n.val().length)return n.val(""),!1}),e.on("click",".tag-item .del",function(){var t,e=i(this).parent(),n=i(this).attr("data-del-val");t=n,e.remove(),s=(s=(s=s.replace(t,"")).replace(/(^,)|(,$)/,"")).replace(/,,/,","),a.val(s),b()})},getInputTextLength:function(e,t,n){var a=Number(t.data("max"));t.each(function(){var t=e(this).val().length;a<t&&n.addClass("hl"),n.html("已输入<b>"+t+"</b>")}),t.on("input change",function(){var t=e(this).val().length;a<t&&n.addClass("hl"),n.html("已输入<b>"+t+"</b>")})},inputLivePreview:function(a){a("[data-preview-target]").on("input change",function(){var t=a(this).data("preview-target"),e=Number(a(this).data("max")),n=a(this).val();n.length>e&&(n=n.substring(0,e)+"..."),a(t).text(n)})},analytics:function(o){var i=o("[data-wba-source]").length&&o("[data-wba-source]").data("wba-source")||window.wbaSource||document.domain;o("a[data-wba-campaign]").each(function(){var t=o(this),e=t.data("wba-campaign"),n=t.data("wba-media")||"link",a=t.attr("href");a+=a.match("[?]")?"&":"?",a+="utm_source="+i,a+="&utm_media="+n,a+="&utm_campaign="+e,t.attr("href",a)})},tabs:function(t,e,n){var a,n=n||{},o=e||t("#J_tabBox"),i=n.tabNav||o.find(".tab-nav-item,.tab-nav li"),r=n.tabCont||o.find(".tab-cont"),s=n.currClass||"current",c=n.callBackFn;i.on("click",function(){a=t(this).index(),i.removeClass(s).eq(a).addClass(s),r.removeClass(s).eq(a).addClass(s),c&&c()})},navTabs:function(n){var a,t;0<n(".wbs-tabs").length&&(a=n(".wbs-tabs .tab-item"),t=0,"undefined"!=typeof localStorage&&(t=localStorage.getItem("WB_SST_active_tab")),n("#optionsframework-wrap .tab-content").eq(t).addClass("current").siblings(".tab-content").removeClass("current"),n("#optionsframework-wrap .tab-item").eq(t).addClass("current").siblings(".tab-item").removeClass("current"),a.on("click",function(t){t.preventDefault(),a.removeClass("current"),n(this).addClass("current").siblings(".tab-item").removeClass("current"),"undefined"!=typeof localStorage&&localStorage.setItem("WB_SST_active_tab",n(this).index());var e=n(this).attr("data-href");return n(e).addClass("current").siblings(".tab-content").removeClass("current"),!1}))},range:function(e,t,n){(t||e(".wbs-input-range")).on("input change",function(){var t=n&&n(e(this).val())||e(this).val();e(this).next(".wbs-range-val").html(t)})},copy:function(t){t.select(),document.execCommand("Copy"),wbui.toast("已复制")}},jQuery(document).ready(function(t){WB.SSTSettings.init(t),localStorage.getItem("WB_SST_NOTICE_CLOSE")||t("#J_sstNotice").slideDown(),t("#J_sstNotice .sst-notice-close").on("click",function(){t("#J_sstNotice").hide(),localStorage.setItem("WB_SST_NOTICE_CLOSE",!0)}),t(".wbs-aside-sst").find(".tab-item").on("click",function(){t(this).addClass("current").siblings(".tab-item").removeClass("current")}),t("#optionsframework-wrap").find("input,textarea").on("change",function(){t(window).on("beforeunload",function(){return confirm("您修改的设置尚未保存，确定离开此页面吗？")})}),t("#optionsframework-submit .wbs-btn-primary").on("click",function(){t(window).unbind("beforeunload")})});