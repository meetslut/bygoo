(self.webpackChunkwbolt_plugins=self.webpackChunkwbolt_plugins||[]).push([[65],{2450:(t,s,a)=>{"use strict";var e=a(5318);Object.defineProperty(s,"X",{value:!0}),s.Z=void 0;var o=a(1293),n=e(a(9560)),i={name:"Overall",data:function(){return{form_changed:0,is_loaded:0,is_pro:0,action:wb_cnf.action||{act:"",fetch:"",push:""},opt:{filter:{},rule:{},proxy_manual:[]},scan_domain:"",scan_running:!1,scan_status:!1,cur_one:null,scan:{finnish:0,num:0},job:{dl_all:0,run_finnish:0,succ_num:0,fail_num:0,img_data:[],img_offset:0,proxy:"",curent_idx:-1,is_download:0,finnish:1,chk_all:0,scan:[],scan_num:0,scan_total:0,percent:0,images:[],domain:[],scan_type:["post"],scan_status:["publish"],post_types,post_status,category,start_id:"",finnish_id:"",sort:"1",cat:"",img_md5:{},done_num:0,job_num:0}}},components:{},created:function(){this._get_data()},filters:{},methods:{_get_data:function(){var t=this;(0,o.getData)({action:t.action.act,do:t.action.fetch}).then((function(s){t.has_pro(),t.opt=s.data.opt,t.is_loaded=1}))},messageListener:function(t){var s=this;try{if(t.data&&t.data&&t.data.cmd&&t.data.image){var a=t.data.data,e=(0,n.default)(t.data.image),o=s.job.img_md5[e],i=s.job.img_data[o];if(a.code?(s.job.fail_num++,i&&(i.status=2)):(s.job.succ_num++,i&&(i.status=1)),i)(o=s.job.scan.indexOf(i.id))>-1&&s.job.scan.splice(o,1);s.down_done()}}catch(t){}},del_scan_domain:function(t){this.job.domain.splice(t,1)},add_scan_domain:function(){var t=this;t.job.domain.push(t.scan_domain),t.scan_domain=""},del_scan_img:function(t){var s=this;if(1==s.job.finnish)if(1!=s.job.is_download){s.job.img_data.splice(t,1);var a=s.job.images.splice(t,1);if(a.length>0){var e=a[0].id;(t=s.job.scan.indexOf(e))>-1&&s.job.scan.splice(t,1)}}else wbui.toast("正在采集中......");else wbui.toast("扫描未完成。")},check_all:function(){var t=this;if(1==t.job.finnish)if(1!=t.job.is_download)if("1"==t.job.chk_all)t.job.scan=[];else{var s={};t.job.scan=[];for(var a=0;a<t.job.images.length;a++)s=t.job.images[a],t.job.scan.push(s.id)}else wbui.toast("正在采集中......");else wbui.toast("扫描未完成。")},drop_selected_scan_img:function(){var t=this;if(1!=t.job.is_download)if(1==t.job.finnish)if(t.job.scan.length<1)wbui.toast("请选择记录。");else for(var s={},a=0;a<t.job.images.length;a++){s=t.job.images[a];var e=t.job.scan.indexOf(s.id);e>-1&&(t.job.images.splice(a,1),t.job.img_data.splice(a,1),t.job.scan.splice(e,1))}else wbui.toast("扫描未完成。");else wbui.toast("正在采集中......")},down_done:function(){var t=this;t.job.done_num++,t.job.done_num>=t.job.job_num&&(t.job.curent_idx=-1,t.job.is_download=0,t.job.run_finnish=1,t.job.done_num=0,t.job.job_num=0)},down_one:function(){var t=this;t.job.curent_idx++;var s=t.job.curent_idx,a=t.job.images;if(t.job.dl_all&&(a=t.job.img_data),!(s>=a.length)){var e=a[s];if(!t.job.dl_all&&t.job.scan.indexOf(e.id)<0)t.down_one();else if(1!=e.status){var o={action:"wb_scrapy_image",do:"down",image:e.src,id:e.id,key:e.key,proxy:t.job.proxy};e.status=3,t.cur_one=e;var i=(0,n.default)(e.src);t.job.img_md5[i]=s,t.job.job_num++;var c=jQuery("#wb-wbsm-btn-spy-batch-ext").attr("chrome-ex");if(t.is_pro&&c&&"ext"==o.proxy)return jQuery("#wb-wbsm-btn-spy-batch-ext").text(JSON.stringify({ajaxurl:wb_ajaxurl,param:o})),jQuery("#wb-wbsm-btn-spy-batch-ext").click(),void setTimeout((function(){t.down_one()}),350);jQuery.ajax({url:ajaxurl,type:"POST",async:!0,dataType:"json",data:o,success:function(s){s.code?(e.status=2,t.job.fail_num++):(e.status=1,t.job.succ_num++);var a=t.job.scan.indexOf(e.id);a>-1&&t.job.scan.splice(a,1),t.down_done()},error:function(){e.status=2,t.job.fail_num++;var s=t.job.scan.indexOf(e.id);s>-1&&t.job.scan.splice(s,1),t.down_done()}}),setTimeout((function(){t.down_one()}),350)}else t.down_one()}},down_scan_img:function(){var t=this;1!=t.job.is_download?1==t.job.finnish?(t.job.dl_all=1,t.start_down()):wbui.toast("扫描未完成。"):wbui.toast("正在采集中......")},down_selected_scan_img:function(){var t=this;1!=t.job.is_download?1==t.job.finnish?t.job.scan.length<1?wbui.toast("请选择记录。"):(t.job.dl_all=0,t.start_down()):wbui.toast("扫描未完成。"):wbui.toast("正在采集中......")},start_down:function(){var t=this,s='<div class="scrapy-list-inner" id="batch_use_proxy"><dl class="selector-bar"><dd><label><input name="proxy" class="wbs-radio proxy" value="none" checked type="radio"> <span>服务器采集</span></label>';if(t.opt.proxy_manual&&t.opt.proxy_manual.length>0)for(var a=0;a<t.opt.proxy_manual.length;a++){var e=t.opt.proxy_manual[a];s+=e.name?'<label><input name="proxy" class="wbs-radio proxy" value="'+a+'" type="radio"> <span>代理['+e.name+"]采集</span></label>":""}s+='<label><input name="proxy" class="wbs-radio proxy" id="WBSPY_check_ext" value="ext" type="radio"> <span>浏览器采集1</span> ',s+=t.is_pro?"":' <i class="tag-pro">Pro</i>',s+="</label></dd></dl></div>",wbui.open({title:"选择采集模式",className:"wbui-set-type",content:s,btn:["开始采集","放弃采集"],success:function(){t.has_pro(),jQuery("#WBSPY_check_ext").on("click",(function(){return t.check_ext(this)}))},yes:function(){var s=jQuery("#batch_use_proxy .proxy:checked").val();t.job.proxy=s,t.job.is_download=1,t.job.curent_idx=-1,t.job.run_finnish=0,t.job.succ_num=0,t.job.fail_num=0,t.down_one()},no:function(){}})},load_more_img:function(){for(var t=this.job,s=0,a=t.img_offset;a<t.img_data.length&&!(++s>10);a++)t.images.push(t.img_data[a]);t.img_offset=a},run_scan:function(){var t=this;if(t.scan_status=1,1!=t.job.is_download){1==t.job.finnish&&(t.job.images=[],t.job.img_data=[],t.job.img_offset=0),t.scan_running=!0;var s={action:"wb_scrapy_image",do:"scan",domain:t.job.domain,scan_type:t.job.scan_type,scan_status:t.job.scan_status,cat:t.job.cat,start_id:t.job.start_id,finnish_id:t.job.finnish_id,sort:t.job.sort};jQuery.post(ajaxurl,s,(function(s){if(s.code)wbui.toast(s.desc);else if(t.job.scan_num=s.job.scan_num,t.job.scan_total=s.job.total,t.job.finnish=s.job.finnish,s.job.finnish||s.job.total<1?(t.scan_running=!1,t.job.percent=100,t.scan.finnish=1,t.scan.num=t.job.img_data.length):(t.job.percent=Math.round((s.job.offset-s.job.num)/s.job.total*100),setTimeout((function(){t.run_scan()}),250)),s.images.length>0){for(var a=0;a<s.images.length;a++)t.job.img_data.push(s.images[a]);if(t.job.images.length<10){var e=10-t.job.images.length;for(a=0;a<Math.min(e,s.images.length);a++)t.job.images.push(s.images[a]);t.job.img_offset=t.job.images.length}}}),"json")}else wbui.toast("正在采集中......")},check_ext:function(t){var s=this;return s.is_pro?imgspider_ver&&window.imgspider?!!document.querySelector("#wb-wbsm-btn-spy-batch-ext").getAttribute("chrome-ex")||(wbui.toast("未检测到浏览器插件: Wordpress图片采集助手。"),!1):(s.$router.push({path:"/extension"}),wbui.closeAll(),!1):(wbui.confirm("该功能为Pro版本专属。",{btn:["了解详情","取消"],yes:function(){s.$router.push({path:"/extension"})}}),!1)},has_pro:function(){return this.is_pro=imgspider_ver&&window.imgspider?1:0,this.is_pro}},computed:{load_more:function(){var t=this;return t.job.img_data.length>0&&t.job.img_offset+10<t.job.img_data.length?1:0}},mounted:function(){window.addEventListener("message",this.messageListener,!1)},destroyed:function(){window.removeEventListener("message",this.messageListener,!1)}};s.Z=i},5065:(t,s,a)=>{"use strict";a.r(s),a.d(s,{__esModule:()=>o.X,default:()=>c});var e=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"wbs-content overall"},[a("div",{staticClass:"wbs-main"},[a("table",{staticClass:"wbs-form-table"},[a("tbody",[a("tr",[a("th",{staticClass:"row w8em"},[t._v("扫描类型")]),t._v(" "),a("td",[a("div",{staticClass:"selector-bar"},t._l(t.job.post_types,(function(s,e){return a("label",{key:e},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.job.scan_type,expression:"job.scan_type"}],attrs:{type:"checkbox"},domProps:{value:e,checked:Array.isArray(t.job.scan_type)?t._i(t.job.scan_type,e)>-1:t.job.scan_type},on:{change:function(s){var a=t.job.scan_type,o=s.target,n=!!o.checked;if(Array.isArray(a)){var i=e,c=t._i(a,i);o.checked?c<0&&t.$set(t.job,"scan_type",a.concat([i])):c>-1&&t.$set(t.job,"scan_type",a.slice(0,c).concat(a.slice(c+1)))}else t.$set(t.job,"scan_type",n)}}}),t._v(" "),a("span",[t._v(t._s(s))])])})),0)])]),t._v(" "),a("tr",[a("th",{staticClass:"row"},[t._v("文章ID区间")]),t._v(" "),a("td",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.job.start_id,expression:"job.start_id"}],attrs:{type:"text"},domProps:{value:t.job.start_id},on:{input:function(s){s.target.composing||t.$set(t.job,"start_id",s.target.value)}}}),t._v(" ~\n          "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.job.finnish_id,expression:"job.finnish_id"}],attrs:{type:"text"},domProps:{value:t.job.finnish_id},on:{input:function(s){s.target.composing||t.$set(t.job,"finnish_id",s.target.value)}}})])]),t._v(" "),a("tr",[a("th",{staticClass:"row"},[t._v("文章状态")]),t._v(" "),a("td",t._l(t.job.post_status,(function(s,e){return a("label",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.job.scan_status,expression:"job.scan_status"}],attrs:{type:"checkbox"},domProps:{value:e,checked:Array.isArray(t.job.scan_status)?t._i(t.job.scan_status,e)>-1:t.job.scan_status},on:{change:function(s){var a=t.job.scan_status,o=s.target,n=!!o.checked;if(Array.isArray(a)){var i=e,c=t._i(a,i);o.checked?c<0&&t.$set(t.job,"scan_status",a.concat([i])):c>-1&&t.$set(t.job,"scan_status",a.slice(0,c).concat(a.slice(c+1)))}else t.$set(t.job,"scan_status",n)}}}),t._v(" "+t._s(s)+" ")])})),0)]),t._v(" "),a("tr",[a("th",{staticClass:"row"},[t._v("扫描顺序")]),t._v(" "),a("td",[a("label",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.job.sort,expression:"job.sort"}],attrs:{type:"radio",value:"1"},domProps:{checked:t._q(t.job.sort,"1")},on:{change:function(s){return t.$set(t.job,"sort","1")}}}),t._v("ID降序")]),t._v(" "),a("label",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.job.sort,expression:"job.sort"}],attrs:{type:"radio",value:"2"},domProps:{checked:t._q(t.job.sort,"2")},on:{change:function(s){return t.$set(t.job,"sort","2")}}}),t._v("ID顺序")])])]),t._v(" "),a("tr",[a("th",{staticClass:"row"},[t._v("分类目录")]),t._v(" "),a("td",[a("select",{directives:[{name:"model",rawName:"v-model",value:t.job.cat,expression:"job.cat"}],on:{change:function(s){var a=Array.prototype.filter.call(s.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.job,"cat",s.target.multiple?a:a[0])}}},[a("option",{attrs:{value:""}},[t._v("所有分类")]),t._v(" "),t._l(t.job.category,(function(s,e){return a("option",{domProps:{value:e}},[t._v(t._s(s))])}))],2)])]),t._v(" "),a("tr",[a("th",{staticClass:"row"},[t._v("例外地址")]),t._v(" "),a("td",[t._l(t.job.domain,(function(s,e){return a("div",{staticClass:"sc-block"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.job.domain[e],expression:"job.domain[idx]"}],staticClass:"wbs-input wbs-input-short",domProps:{value:t.job.domain[e]},on:{input:function(s){s.target.composing||t.$set(t.job.domain,e,s.target.value)}}}),t._v(" "),a("span",{staticClass:"wb-ctrl-item ctrl-del",attrs:{title:"删除"},on:{click:function(s){return t.del_scan_domain(e)}}},[a("svg",{staticClass:"wb-icon sico-del"},[a("use",{attrs:{"xlink:href":"#sico-del"}})])])])})),t._v(" "),a("div",{staticClass:"sc-block"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.scan_domain,expression:"scan_domain"}],staticClass:"wbs-input wbs-input-short",attrs:{placeholder:""},domProps:{value:t.scan_domain},on:{input:function(s){s.target.composing||(t.scan_domain=s.target.value)}}}),t._v(" "),a("span",{staticClass:"wb-ctrl-item",on:{click:function(s){return t.add_scan_domain()}}},[t._v("+增加")])])],2)]),t._v(" "),a("tr",[a("th",{staticClass:"row"}),t._v(" "),a("td",[a("span",{directives:[{name:"show",rawName:"v-show",value:t.scan_status,expression:"scan_status"}],staticClass:"button button-disabled"},[t._v(t._s(100==t.job.percent?"扫描完成":"扫描中"))]),t._v(" "),a("a",{directives:[{name:"show",rawName:"v-show",value:!t.scan_status,expression:"!scan_status"}],staticClass:"button-primary",on:{click:function(s){return t.run_scan()}}},[t._v("执行扫描")]),t._v(" "),a("p",{staticClass:"description mt"},[t._v("注：仅且站点能够正常加载的外链图片，才可以使用图片采集助手执行全局扫描采集。")])])])])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.scan_status,expression:"scan_status"}],staticClass:"scan-result"},[a("div",{staticClass:"status-bar",class:{done:100==t.job.percent}},[a("div",{staticClass:"bar-inner"},[a("span",[t._v(t._s(t.job.scan_num)+"/"+t._s(t.job.scan_total))]),t._v(" "),a("span",[t._v("("+t._s(t.job.percent)+"%)")])]),t._v(" "),a("div",{staticClass:"bar",style:"width:"+t.job.percent+"%;"})]),t._v(" "),t.scan.finnish?a("div",{staticClass:"description mt align-center"},[a("svg",{staticClass:"wb-icon wbsico-tick"},[a("use",{attrs:{"xlink:href":"#wbsico-tick"}})]),t._v(" "),a("span",{staticClass:"ib"},[t._v("扫描完成，查找到"+t._s(t.job.img_data.length)+"张站外图片。")])]):t._e(),t._v(" "),t._m(0),t._v(" "),a("div",[a("table",{staticClass:"wbs-table"},[a("thead",[a("tr",[a("th",{staticClass:"td-select"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.job.chk_all,expression:"job.chk_all"}],attrs:{type:"checkbox","true-value":"1","false-value":"0"},domProps:{checked:Array.isArray(t.job.chk_all)?t._i(t.job.chk_all,null)>-1:t._q(t.job.chk_all,"1")},on:{click:function(s){return t.check_all()},change:function(s){var a=t.job.chk_all,e=s.target,o=e.checked?"1":"0";if(Array.isArray(a)){var n=t._i(a,null);e.checked?n<0&&t.$set(t.job,"chk_all",a.concat([null])):n>-1&&t.$set(t.job,"chk_all",a.slice(0,n).concat(a.slice(n+1)))}else t.$set(t.job,"chk_all",o)}}})]),t._v(" "),a("th",{staticClass:"w40"},[t._v("扫描地址")]),t._v(" "),a("th",{staticClass:"w35"},[t._v("外链图片")]),t._v(" "),a("th",[t._v("状态")]),t._v(" "),a("th",[t._v("操作")])])]),t._v(" "),a("tbody",[t._l(t.job.images,(function(s,e){return a("tr",{key:e},[a("td",[0==s.status?a("input",{directives:[{name:"model",rawName:"v-model",value:t.job.scan,expression:"job.scan"}],attrs:{type:"checkbox"},domProps:{value:s.id,checked:Array.isArray(t.job.scan)?t._i(t.job.scan,s.id)>-1:t.job.scan},on:{change:function(a){var e=t.job.scan,o=a.target,n=!!o.checked;if(Array.isArray(e)){var i=s.id,c=t._i(e,i);o.checked?c<0&&t.$set(t.job,"scan",e.concat([i])):c>-1&&t.$set(t.job,"scan",e.slice(0,c).concat(e.slice(c+1)))}else t.$set(t.job,"scan",n)}}}):t._e()]),t._v(" "),a("td",[a("a",{attrs:{href:s.url,target:"_blank"}},[a("span",{staticClass:"url"},[t._v(t._s(s.url))])])]),t._v(" "),a("td",[a("span",{staticClass:"url"},[t._v(t._s(s.src))])]),t._v(" "),a("td",[a("span",{class:"wb-status-tag "+{0:"",1:"success",2:"done",3:"new"}[s.status]},[t._v(t._s({0:"未采集",1:"成功",2:"失败",3:"采集中..."}[s.status]))])]),t._v(" "),a("td",[0==s.status&&1!=t.job.is_download?a("a",{staticClass:"link",on:{click:function(s){return t.del_scan_img(e)}}},[t._v("放弃")]):t._e()])])})),t._v(" "),a("tr",{directives:[{name:"show",rawName:"v-show",value:t.load_more,expression:"load_more"}]},[a("td",{attrs:{colspan:"5"}},[a("div",{staticClass:"btns-bar"},[a("a",{staticClass:"more-btn",on:{click:function(s){return t.load_more_img()}}},[t._v("查看更多")])])])])],2),t._v(" "),a("tfoot",[a("tr",[a("td",{attrs:{colspan:"5"}},[a("button",{staticClass:"button button-primary",attrs:{disabled:t.job.images.length<1||1==t.job.is_download},on:{click:function(s){return t.down_scan_img()}}},[t._v("全部采集")]),t._v(" "),a("button",{staticClass:"button button-primary",attrs:{disabled:0==t.job.scan.length||1==t.job.is_download},on:{click:function(s){return t.down_selected_scan_img()}}},[t._v("批量采集")]),t._v(" "),a("button",{staticClass:"button button-cancel",attrs:{disabled:0==t.job.scan.length||1==t.job.is_download},on:{click:function(s){return t.drop_selected_scan_img()}}},[t._v("批量放弃")])])])])]),t._v(" "),t.job.run_finnish?a("div",{staticClass:"description mt"},[t._v("批量采集任务完成，"+t._s(t.job.succ_num)+"张图片成功，"+t._s(t.job.fail_num)+"张图片失败。")]):t._e()])])]),t._v(" "),t.is_loaded&&!t.is_pro?a("wbs-more-sources"):t._e(),t._v(" "),a("wbs-footer")],1)};e._withStripped=!0;var o=a(2450);const n=o.Z;var i=(0,a(1900).Z)(n,e,[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("h4",{staticClass:"sc-title-sub"},[a("span",[t._v("扫描记录")])])}],!1,null,null,null);i.options.__file="__src/js/setting/views/Overall.vue";const c=i.exports}}]);